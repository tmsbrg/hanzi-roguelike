class Room {
    constructor(map, actors) {
        this.map = map
        this.actors = actors
    }
}

class Actor {
    constructor(graphic, name, x, y, interact_function = null) {
        this.graphic = graphic
        this.name = name
        this.x = x
        this.y = y
        this.interact_function = interact_function
    }
}

function add_context_buttons(buttoninfo) {
    buttonLoop: for (button of buttoninfo) {
        let btn = document.createElement("button");
        btn.innerHTML = button[0];
        btn.addEventListener("click", button[1]);
        contextbuttons.appendChild(btn);
    }
}

function reset_context_buttons() {
    contextbuttons.innerHTML = null;
}

function set_context_buttons(text, buttoninfo) {
    reset_context_buttons();
    contextbuttons.textContent = text;
    add_context_buttons(buttoninfo);
}

function mother_subject_father() {
    statusinfo.textContent = "Mother: Your father has been getting more and more ill recently. I'm afraid only your aunt Leane may know how to make him better again.";
    mother_subjects.set("aunt Leane", function() {
        statusinfo.textContent = "Mother: She lives on a farm in the hills east of the river. It's a bit of a walk, I'm afraid. I hope you're willing to get to her for your father's sake.";
    });
    set_context_buttons("Subjects:", mother_subjects);
}

mother_subjects = new Map();
mother_subjects.set("father", mother_subject_father);
mother_subjects.set("bye", function() {
    statusinfo.textContent = "Mother: See you soon, son. And remember to eat your vitamins!";
    reset_context_buttons();
});

function talk_to_mother() {
    statusinfo.textContent = "You talk to your mother.";
    set_context_buttons("Subjects:", mother_subjects);
}

var room00 = new Room([
    [ 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3, ],
    [ 3,0,0,0,0,0,0,0,0,0,0,0,0,0,3, ],
    [ 3,0,0,0,0,0,0,0,0,0,0,0,0,0,3, ],
    [ 3,0,1,1,1,1,1,1,1,1,0,0,5,0,3, ],
    [ 3,0,1,0,0,1,0,0,0,1,0,0,0,0,3, ],
    [ 3,0,1,0,0,1,0,0,0,1,0,0,0,0,3, ],
    [ 3,0,1,0,0,0,0,0,0,1,0,0,0,0,3, ],
    [ 3,0,1,1,1,1,1,1,0,1,0,0,0,0,3, ],
    [ 3,0,0,0,0,0,0,0,0,0,0,0,0,0,3, ],
    [ 3,0,0,0,0,0,0,0,0,0,1,1,1,0,3, ],
    [ 3,0,0,5,0,0,0,0,0,0,0,0,1,0,3, ],
    [ 3,0,0,0,0,0,0,0,0,0,1,1,1,0,3, ],
    [ 3,0,0,0,0,0,0,0,0,0,0,0,0,0,3, ],
    [ 3,3,3,3,3,3,0,0,0,0,3,3,3,3,3, ]
], [
    new Actor("父", "father", 4, 4, function() { statusinfo.textContent = "Your father is sleeping soundly on the bed." }),
    new Actor("母", "mother", 8, 5, talk_to_mother),
]);

const room_height = room00.map.length;
const room_width = room00.map[0].length;

var room10 = new Room([
    [ 3,3,3,3,3,3,0,0,0,0,3,3,3,3,3, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,5,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,5,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,5,0,0,0,0, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4, ]
], []);

var room11 = new Room([
    [ 5,5,5,5,5,5,5,5,5,5,5,5,5,5,5, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 0,0,5,0,0,0,0,0,0,0,0,5,0,0,0, ],
    [ 0,0,0,0,0,0,5,0,0,0,0,0,0,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 0,0,0,5,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,5,0,0,0,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,5,0,0, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, ],
    [ 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4, ]
], []);

var room12 = new Room([
    [ 5,0,0,0,0,5,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,5,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,5,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ]
], []);

var room22 = new Room([
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,5,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,5,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,5,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 4,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, ],
    [ 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, ]
], []);

var room02 = new Room([
    [ 5,5,5,5,5,5,5,5,5,5,5,5,5,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,5,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,0,5,0,0,2,2, ],
    [ 5,0,0,0,5,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,5,0,0,0,0,2,2, ],
    [ 5,0,5,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,5,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,0,0,0,0,0,0,0,0,2,2, ],
    [ 5,0,0,0,0,5,0,0,0,0,0,0,0,2,2, ]
], []);

/*
var room10 = new Room([
    [ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,1, ],
    [ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, ]
], []);
*/

var world = [
    [room00, null,   room02],
    [room10, room11, room12],
    [null,   null,   room22],
];

const world_width = world.length;
const world_height = world.length;
