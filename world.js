class Room {
    constructor(map, actors) {
        this.map = map
        this.actors = actors
    }
}

class Actor {
    constructor(graphic, name, x, y, interact_function = null) {
        this.graphic = graphic
        this.name = name
        this.x = x
        this.y = y
        this.interact_function = interact_function
    }
}

function add_context_buttons(buttoninfo) {
    buttonLoop: for (button of buttoninfo) {
        let btn = document.createElement("button");
        btn.innerHTML = button[0];
        btn.addEventListener("click", button[1]);
        contextbuttons.appendChild(btn);
    }
}

function reset_context_buttons() {
    contextbuttons.innerHTML = null;
}

function set_context_buttons(text, buttoninfo) {
    reset_context_buttons();
    contextbuttons.textContent = text;
    add_context_buttons(buttoninfo);
}

function mother_subject_father() {
    statusinfo.textContent = "Mother: Your father has been getting more and more ill recently. I'm afraid only your aunt Leane may know how to make him better again.";
    mother_subjects.set("aunt Leane", function() {
        statusinfo.textContent = "Mother: She lives on a farm in the hills east of the river. It's a bit of a walk, I'm afraid. I hope you're willing to get to her for your father's sake.";
    });
    set_context_buttons("Subjects:", mother_subjects);
}

mother_subjects = new Map();
mother_subjects.set("father", mother_subject_father);
mother_subjects.set("bye", function() {
    statusinfo.textContent = "Mother: See you soon, son. And remember to eat your vitamins!";
    reset_context_buttons();
});

function talk_to_mother() {
    statusinfo.textContent = "You talk to your mother.";
    set_context_buttons("Subjects:", mother_subjects);
    return false;
}

var room00 = new Room([
    [ 52,52,52,52,52,52,52,52,52,52,52,52,52,52,52, ],
    [ 52,00,00,00,00,00,00,00,00,00,00,00,00,00,52, ],
    [ 52,00,00,00,00,00,00,00,00,00,00,00,00,00,52, ],
    [ 52,00,50,50,50,50,50,50,50,50,00,00,54,00,52, ],
    [ 52,00,50,01,01,50,01,01,01,50,00,00,00,00,52, ],
    [ 52,00,50,01,01,50,01,01,01,50,00,00,00,00,52, ],
    [ 52,00,50,01,01,01,01,01,01,50,00,00,00,00,52, ],
    [ 52,00,50,50,50,50,50,50,01,50,00,00,00,00,52, ],
    [ 52,00,00,00,00,00,00,00,02,00,00,00,00,00,52, ],
    [ 52,00,00,00,00,00,00,02,02,00,50,50,50,00,52, ],
    [ 52,00,00,54,00,00,00,02,02,02,01,01,50,00,52, ],
    [ 52,00,00,00,00,00,00,02,02,00,50,50,50,00,52, ],
    [ 52,00,00,00,00,00,00,02,02,00,00,00,00,00,52, ],
    [ 52,52,52,52,52,52,00,02,02,00,52,52,52,52,52, ]
], [
    new Actor("父", "father", 4, 4, function() { statusinfo.textContent = "Your father is sleeping soundly on the bed."; return false; }),
    new Actor("母", "mother", 8, 5, talk_to_mother),
    new Actor("门", "door", 8, 7, function () { statusinfo.textContent = "You open the door."; return true; }),
    new Actor("门", "door", 10, 10, function () { statusinfo.textContent = "You open the door."; return true; }),
    new Actor("厕", "toilet", 11, 10, function () { statusinfo.textContent = "You relieve yourself on the toilet."; return false; }),
]);

const room_height = room00.map.length;
const room_width = room00.map[0].length;

var room10 = new Room([
    [ 52,52,52,52,52,52,00,02,02,00,52,52,52,52,52, ],
    [ 53,00,00,00,00,00,00,02,02,00,00,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,02,02,00,00,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,02,02,00,00,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,02,02,00,54,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,02,02,00,00,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,02,02,02,02,02,02,02,02, ],
    [ 53,00,00,54,00,00,00,02,02,02,02,02,02,02,02, ],
    [ 53,00,00,00,00,00,00,02,02,02,02,02,02,02,02, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,00,00,00,54,00,00,00,00, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,00,00, ],
    [ 53,53,53,53,53,53,53,53,53,53,53,53,53,53,53, ]
], []);

var room11 = new Room([
    [ 54,54,54,54,54,54,54,54,54,54,54,54,54,54,54, ],
    [ 00,00,00,54,00,00,00,54,00,00,00,00,00,00,54, ],
    [ 00,00,00,00,00,00,00,00,00,00,00,00,00,54,00, ],
    [ 00,00,54,00,54,00,00,00,54,00,00,54,00,00,00, ],
    [ 00,00,00,00,00,00,54,00,00,00,00,00,00,00,00, ],
    [ 00,00,00,00,00,00,00,00,00,54,00,00,00,00,00, ],
    [ 02,02,02,02,02,02,02,02,02,02,02,02,02,02,02, ],
    [ 02,02,02,02,02,02,02,02,02,02,02,02,02,02,02, ],
    [ 02,02,02,02,02,02,02,02,02,02,02,02,02,02,02, ],
    [ 00,00,00,00,00,00,00,00,00,54,00,00,00,00,00, ],
    [ 00,00,00,54,00,00,00,00,00,00,00,00,00,00,00, ],
    [ 00,00,00,00,00,00,00,00,00,00,00,00,54,00,00, ],
    [ 00,00,00,00,00,00,00,00,00,00,00,00,00,00,00, ],
    [ 53,53,53,53,53,53,53,53,53,53,53,53,53,53,53, ]
], []);

var room12 = new Room([
    [ 54,00,00,00,00,54,00,00,02,02,00,00,00,51,51, ],
    [ 54,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 00,00,00,00,54,00,00,00,02,02,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 02,02,02,02,02,02,02,02,02,02,02,02,10,10,51, ],
    [ 02,02,02,02,02,02,02,02,02,02,02,02,10,10,51, ],
    [ 02,02,02,02,02,02,02,02,02,02,02,02,10,10,51, ],
    [ 00,00,00,00,00,00,00,00,50,00,50,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,50,00,50,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,50,50,50,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ]
], [
    new Actor("门", "door", 9, 9, function() { statusinfo.textContent = "Locked."; }),
    new Actor("纽", "lever", 9, 10, function() { statusinfo.textContent = "You pull the lever and hear the noise of metal chains and creaking wood."; }),
]);

var room22 = new Room([
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,54,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,54,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,54,00,00,00,00,00,00,00,51,51, ],
    [ 53,00,00,00,00,00,00,00,00,00,00,00,51,51,51, ],
    [ 53,00,00,00,51,51,51,00,00,00,51,51,51,51,51, ],
    [ 51,51,51,51,51,51,51,51,51,51,51,51,51,51,51, ],
    [ 51,51,51,51,51,51,51,51,51,51,51,51,51,51,51, ]
], [
    new Actor("门", "door", 0, 7, function() { statusinfo.textContent = "Locked."; }),

]);
var room02 = new Room([
    [ 53,53,53,53,53,53,53,53,53,53,53,53,53,51,51, ],
    [ 00,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,54,00,00,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,00,00,54,00,00,51,51, ],
    [ 00,00,00,00,54,00,00,00,00,00,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,00,00,00,00,00,51,51, ],
    [ 02,02,02,02,02,02,02,02,02,02,00,00,00,51,51, ],
    [ 02,02,02,02,02,02,02,02,02,02,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 00,00,54,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 54,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 00,00,00,00,00,00,00,00,02,02,00,00,00,51,51, ],
    [ 54,00,00,00,00,54,00,00,02,02,00,00,00,51,51, ]
], []);

var room01 = new Room([
    [ 53,53,53,53,53,53,53,00,00,02,02,00,53,53,53, ],
    [ 53,00,00,00,00,00,00,00,00,02,02,00,00,00,00, ],
    [ 54,00,00,00,00,00,00,00,00,02,02,00,00,00,00, ],
    [ 54,00,00,00,00,00,00,00,00,02,02,00,00,00,00, ],
    [ 54,00,00,00,00,00,00,00,00,00,02,02,00,00,00, ],
    [ 54,00,00,00,00,00,00,00,00,00,02,02,00,00,00, ],
    [ 54,54,00,54,00,00,00,00,00,00,02,02,02,02,02, ],
    [ 54,00,54,00,00,54,00,54,00,54,00,02,02,02,02, ],
    [ 54,00,00,54,00,00,54,00,00,00,00,00,00,00,00, ],
    [ 54,00,54,00,00,00,00,00,00,54,00,00,00,00,00, ],
    [ 54,54,00,00,00,54,00,54,00,00,00,54,00,54,00, ],
    [ 54,00,00,54,00,00,00,00,00,00,54,00,00,00,54, ],
    [ 54,00,54,00,54,00,00,00,54,00,00,00,00,00,00, ],
    [ 54,54,54,54,54,54,54,54,54,54,54,54,54,54,54, ]
], [
    new Actor("羊", "sheep", 2, 2, null),
    new Actor("羊", "sheep", 4, 2, null),
    new Actor("羊", "sheep", 4, 4, null),
    new Actor("狗", "dog", 7, 3, null),
    new Actor("人", "shepherd", 8, 5, null),
]);

/*
var room10 = new Room([
    [ 50,50,50,50,50,50,50,50,50,50,50,50,50,50,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,00,00,00,00,00,00,00,00,00,00,00,00,00,50, ],
    [ 50,50,50,50,50,50,50,50,50,50,50,50,50,50,50, ]
], []);
*/

var world = [
    [room00, room01, room02],
    [room10, room11, room12],
    [null,   null,   room22],
];

const world_width = world.length;
const world_height = world.length;
